<!-- Code Function: FINAL PROJECT MotoWeb
     Date: 02/06/2025, created by: JERRY -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Community Forum | MotoWeb</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/tech-theme.css">
    <link rel="stylesheet" href="/css/community.css">
    <link rel="icon" href="images/favicon.ico" type="image/x-icon">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Community page specific styles - Modern tech theme */
        .main-container {
            min-height: 100vh;
        }

        .community-main-content {
            display: flex;
            gap: 3rem;
            padding: 2rem 5%;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Sidebar styles - Enhanced tech theme */
        .community-sidebar {
            flex: 0 0 320px;
            background: linear-gradient(145deg, 
                var(--dark-surface) 0%, 
                var(--mid-surface) 50%, 
                var(--light-surface) 100%);
            padding: 2rem;
            border-radius: 20px;
            height: fit-content;
            box-shadow: 
                0 15px 35px rgba(0, 0, 0, 0.4),
                0 0 25px rgba(0, 212, 255, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.1),
                inset 0 -1px 0 rgba(0, 0, 0, 0.2);
            border: 2px solid var(--carbon-gray);
            position: sticky;
            top: 100px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .community-sidebar:hover {
            box-shadow: 
                0 20px 45px rgba(0, 0, 0, 0.5),
                0 0 35px rgba(0, 212, 255, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }

        .community-sidebar h3 {
            font-size: 1.6rem;
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--primary-color);
            text-shadow: 0 0 15px rgba(0, 212, 255, 0.6);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            position: relative;
        }

        .community-sidebar h3::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 30%;
            height: 2px;
            background: linear-gradient(90deg, var(--accent-color), var(--success-color));
            animation: borderExpand 2s ease-in-out infinite alternate;
        }

        @keyframes borderExpand {
            0% { width: 30%; }
            100% { width: 60%; }
        }

        .category-list ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .category-list li {
            margin-bottom: 0.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .category-list li:last-child {
            border-bottom: none;
        }

        .category-list a {
            display: block;
            padding: 1rem 1.5rem;
            color: var(--metallic-silver);
            text-decoration: none;
            border-radius: 12px;
            transition: all 0.3s ease;
            font-weight: 500;
            position: relative;
            border-left: 3px solid transparent;
        }

        .category-list a::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 0;
            background: linear-gradient(45deg, var(--primary-color), var(--accent-color));
            transition: width 0.3s ease;
            z-index: 1;
            border-radius: 12px 0 0 12px;
        }

        .category-list a:hover,
        .category-list a.active {
            background: linear-gradient(90deg, rgba(0, 212, 255, 0.2), rgba(124, 58, 237, 0.1));
            color: white;
            border-left-color: var(--primary-color);
            font-weight: 600;
            box-shadow: 
                0 5px 15px rgba(0, 212, 255, 0.2),
                inset 0 0 20px rgba(0, 212, 255, 0.1);
            transform: translateX(5px);
        }

        .category-list a:hover::before,
        .category-list a.active::before {
            width: 3px;
        }

        .category-list a.active::after {
            content: '‚óè';
            position: absolute;
            right: 1.5rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--success-color);
            font-size: 1.2rem;
            text-shadow: 0 0 8px rgba(0, 255, 136, 0.8);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: translateY(-50%) scale(1); }
            50% { opacity: 0.7; transform: translateY(-50%) scale(1.1); }
        }

        .category-list .count {
            color: var(--metallic-silver);
            font-size: 0.85rem;
            margin-left: 0.5rem;
            padding: 0.2rem 0.5rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .category-list a:hover .count,
        .category-list a.active .count {
            background: var(--success-color);
            color: white;
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
            transform: scale(1.1);
        }

        .popular-tags h3 {
            margin-top: 2rem;
        }

        .tag-cloud {
            display: flex;
            flex-wrap: wrap;
            gap: 0.8rem;
        }

        .tag {
            padding: 0.6rem 1rem;
            background: linear-gradient(145deg, var(--light-surface), var(--mid-surface));
            color: var(--metallic-silver);
            text-decoration: none;
            border-radius: 20px;
            font-size: 0.85rem;
            border: 1px solid var(--carbon-gray);
            transition: all 0.3s ease;
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }

        .tag::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.3s ease;
        }

        .tag:hover {
            background: linear-gradient(45deg, var(--primary-color), var(--accent-color));
            color: white;
            box-shadow: 0 5px 20px rgba(0, 212, 255, 0.3);
            transform: translateY(-3px) scale(1.05);
            border-color: var(--primary-color);
        }

        .tag:hover::before {
            left: 100%;
        }

        /* Discussion display area styles */
        .community-display-area {
            flex: 1;
            background: var(--secondary-color);
        }

        .community-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding: 1.5rem 2rem;
            background: linear-gradient(145deg, var(--mid-surface), var(--dark-surface));
            border-radius: 15px;
            box-shadow: 
                0 8px 25px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .results-count {
            color: var(--metallic-silver);
            font-size: 1.1rem;
            font-weight: 600;
        }

        .view-options .btn {
            font-size: 0.95rem;
            padding: 10px 20px;
        }

        /* Discussion list styles - Enhanced */
        .discussion-list {
            display: grid;
            gap: 2rem;
        }

        .discussion-item {
            background: linear-gradient(145deg, var(--mid-surface), var(--dark-surface));
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 
                0 8px 25px rgba(0, 0, 0, 0.4),
                0 0 20px rgba(0, 212, 255, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 2px solid transparent;
            position: relative;
            color: white;
            overflow: hidden;
        }

        .discussion-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, 
                var(--primary-color), 
                var(--accent-color), 
                var(--success-color));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .discussion-item::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 212, 255, 0.1), transparent);
            transition: left 0.6s ease;
            z-index: 1;
        }

        .discussion-item:hover {
            transform: translateY(-8px);
            box-shadow: 
                0 25px 50px rgba(0, 0, 0, 0.5),
                0 0 40px rgba(0, 212, 255, 0.3),
                0 0 60px rgba(124, 58, 237, 0.2);
            border-color: var(--primary-color);
        }

        .discussion-item:hover::before {
            opacity: 1;
        }

        .discussion-item:hover::after {
            left: 100%;
        }

        .discussion-header {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
            gap: 1rem;
            position: relative;
            z-index: 2;
        }

        .discussion-user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid var(--success-color);
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.3);
            transition: all 0.3s ease;
        }

        .discussion-item:hover .discussion-user-avatar {
            box-shadow: 0 0 25px rgba(0, 255, 136, 0.6);
            transform: scale(1.05);
        }

        .user-info h4 {
            margin: 0;
            color: white;
            font-weight: 700;
        }

        .user-info span {
            color: var(--metallic-silver);
            font-size: 0.9rem;
        }

        .discussion-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: white;
            margin-bottom: 1rem;
            transition: color 0.3s ease;
            position: relative;
            z-index: 2;
        }

        .discussion-item:hover .discussion-title {
            color: var(--primary-color);
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
        }

        .discussion-content {
            color: var(--metallic-silver);
            line-height: 1.6;
            margin-bottom: 1.5rem;
            position: relative;
            z-index: 2;
        }

        .discussion-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 1rem;
            border-top: 1px solid var(--carbon-gray);
            position: relative;
            z-index: 2;
        }

        .discussion-stats {
            display: flex;
            gap: 1.5rem;
        }

        .discussion-stats span {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--metallic-silver);
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .discussion-stats span:hover {
            color: var(--primary-color);
            text-shadow: 0 0 8px rgba(0, 212, 255, 0.5);
        }

        .discussion-stats i {
            color: var(--success-color);
            transition: all 0.3s ease;
        }

        .discussion-stats span:hover i {
            color: var(--primary-color);
            transform: scale(1.1);
        }

        .category-tag {
            background: linear-gradient(45deg, var(--primary-color), var(--accent-color));
            color: white;
            padding: 0.4rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 12px rgba(0, 212, 255, 0.3);
            transition: all 0.3s ease;
        }

        .category-tag:hover {
            background: linear-gradient(45deg, var(--accent-color), var(--success-color));
            box-shadow: 0 6px 20px rgba(124, 58, 237, 0.4);
            transform: translateY(-2px);
        }

        /* Enhanced loading and error states */
        .loading {
            text-align: center;
            padding: 4rem;
            color: var(--metallic-silver);
            font-size: 1.2rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
        }

        .loading i {
            color: var(--primary-color);
            font-size: 2rem;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .no-posts {
            text-align: center;
            padding: 4rem;
            color: var(--metallic-silver);
            font-size: 1.1rem;
            background: linear-gradient(145deg, var(--mid-surface), var(--dark-surface));
            border-radius: 15px;
            border: 1px solid var(--carbon-gray);
        }

        .no-posts::before {
            content: 'üîç';
            display: block;
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* Responsive styles */
        @media (max-width: 1200px) {
            .community-main-content {
                gap: 2rem;
            }
            
            .community-sidebar {
                flex: 0 0 280px;
                padding: 1.5rem;
            }
            
            .community-sidebar h3 {
                font-size: 1.4rem;
            }
        }

        @media (max-width: 768px) {
            .community-main-content {
                flex-direction: column;
                padding: 1rem 3%;
            }

            .community-sidebar {
                flex: none;
                position: static;
                margin-bottom: 2rem;
                padding: 1rem;
                border-radius: 15px;
            }

            .community-sidebar h3 {
                font-size: 1.2rem;
                letter-spacing: 1px;
            }

            .category-list a {
                padding: 0.8rem 1rem;
                font-size: 0.9rem;
            }

            .tag {
                font-size: 0.8rem;
                padding: 0.5rem 0.8rem;
            }

            .community-header {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
                text-align: center;
            }

            .discussion-header {
                flex-direction: column;
                text-align: center;
                gap: 0.8rem;
            }

            .discussion-footer {
                flex-direction: column;
                gap: 1rem;
                align-items: center;
            }

            .discussion-stats {
                gap: 1rem;
            }
        }

        /* Community page content specific styles */
        .community-content {
            padding: 2rem 0;
        }

        /* Page header styles - unified */
        .page-header {
            background: 
                linear-gradient(135deg, 
                    rgba(10, 10, 10, 0.95), 
                    rgba(31, 41, 55, 0.9)),
                radial-gradient(circle at 30% 40%, rgba(0, 212, 255, 0.1), transparent),
                radial-gradient(circle at 70% 60%, rgba(124, 58, 237, 0.1), transparent),
                url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="circuit" patternUnits="userSpaceOnUse" width="40" height="40"><rect width="40" height="40" fill="%23111827"/><path d="M0,20 L40,20 M20,0 L20,40" stroke="%2300d4ff" stroke-width="0.5" opacity="0.3"/><circle cx="20" cy="20" r="2" fill="%2300d4ff" opacity="0.5"/></pattern></defs><rect width="100" height="100" fill="url(%23circuit)"/></svg>');
            background-size: cover, cover, cover, 80px 80px;
            padding: 6rem 5% 4rem;
            text-align: center;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .page-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 2px;
            height: 100%;
            background: linear-gradient(to bottom, transparent, var(--primary-color), transparent);
            animation: scanEffect 8s infinite linear;
        }

        .page-header h1 {
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, 
                #ffffff, 
                var(--primary-color), 
                var(--accent-color), 
                var(--success-color), 
                #ffffff);
            background-size: 400% 400%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: titleGlow 4s ease-in-out infinite;
            text-shadow: 0 0 30px rgba(0, 212, 255, 0.5);
            position: relative;
        }

        .page-header p {
            font-size: 1.3rem;
            color: var(--metallic-silver);
            margin-bottom: 2.5rem;
            opacity: 0.9;
        }

        .search-bar {
            max-width: 600px;
            margin: 0 auto;
            display: flex;
            gap: 0;
            background: linear-gradient(145deg, var(--mid-surface), var(--dark-surface));
            border-radius: 50px;
            border: 2px solid var(--carbon-gray);
            overflow: hidden;
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .search-bar input {
            flex: 1;
            padding: 1.2rem 2rem;
            border: none;
            background: transparent;
            color: white;
            font-size: 1.1rem;
            outline: none;
        }

        .search-bar input::placeholder {
            color: var(--metallic-silver);
        }

        .search-bar button {
            padding: 1.2rem 2rem;
            background: linear-gradient(45deg, var(--primary-color), var(--accent-color));
            border: none;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .search-bar button:hover {
            background: linear-gradient(45deg, var(--accent-color), var(--success-color));
            box-shadow: 0 0 25px rgba(0, 212, 255, 0.5);
        }

        /* Responsive styles */
        @media (max-width: 968px) {
            .page-header h1 {
                font-size: 2.5rem;
            }
            
            .page-header p {
                font-size: 1.1rem;
            }
        }

        @media (max-width: 768px) {
            .page-header {
                padding: 4rem 5% 3rem;
            }
            
            .page-header h1 {
                font-size: 2rem;
            }
            
            .search-bar {
                flex-direction: column;
                border-radius: 20px;
            }
            
            .search-bar input,
            .search-bar button {
                border-radius: 15px;
            }
        }

        @media (max-width: 480px) {
            .page-header {
                padding: 3rem 5% 2rem;
            }
            
            .page-header h1 {
                font-size: 1.8rem;
            }
        }

        /* Enhanced transition effects */
        .category-list a {
            transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1) !important;
        }
        
        .tag {
            transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1) !important;
        }
        
        .search-bar {
            transition: all 0.3s ease !important;
        }

        /* Login prompt modal styles - Enhanced Readability */
        #loginPromptModal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            z-index: 10000;
            backdrop-filter: blur(8px);
        }

        #loginPromptModal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            animation: modalFadeIn 0.3s ease-out;
        }

        #loginPromptModal .modal-content {
            background: linear-gradient(145deg, #1a1a1a, #2d2d2d);
            border-radius: 20px;
            box-shadow: 
                0 25px 50px rgba(0, 0, 0, 0.7),
                0 0 40px rgba(0, 212, 255, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.15);
            border: 2px solid var(--primary-color);
            position: relative;
            animation: modalSlideIn 0.3s ease-out;
        }

        #loginPromptModal .modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid var(--danger-color);
            color: #ffffff;
            font-size: 1.5rem;
            cursor: pointer;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        #loginPromptModal .modal-close:hover {
            background: var(--danger-color);
            color: white;
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(255, 59, 48, 0.5);
        }

        #loginPromptModal h2 {
            color: #ffffff !important;
            text-shadow: 0 0 15px rgba(0, 212, 255, 0.6) !important;
            font-weight: 700 !important;
            font-size: 1.8rem !important;
        }

        #loginPromptModal p {
            color: #e0e0e0 !important;
            line-height: 1.8 !important;
            font-size: 1.1rem !important;
            font-weight: 500 !important;
        }

        #loginPromptModal .login-actions .btn {
            font-weight: 700 !important;
            padding: 1rem 1.5rem !important;
            font-size: 1rem !important;
            border-width: 2px !important;
        }

        #loginPromptModal .btn-primary {
            background: linear-gradient(45deg, var(--primary-color), var(--accent-color)) !important;
            color: #ffffff !important;
            border-color: var(--primary-color) !important;
        }

        #loginPromptModal .btn-outline {
            background: rgba(0, 212, 255, 0.1) !important;
            color: #ffffff !important;
            border-color: var(--primary-color) !important;
        }

        #loginPromptModal .btn-outline:hover {
            background: var(--primary-color) !important;
            color: #ffffff !important;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translate(-50%, -60%) scale(0.8);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        /* Post Modal Styles - Enhanced Readability */
        #post-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            z-index: 10000;
            backdrop-filter: blur(8px);
        }

        #post-modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
            animation: modalFadeIn 0.3s ease-out;
        }

        #post-modal .modal-content {
            background: linear-gradient(145deg, #1a1a1a, #2d2d2d);
            border-radius: 20px;
            max-width: 700px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            padding: 2.5rem;
            box-shadow: 
                0 25px 50px rgba(0, 0, 0, 0.7),
                0 0 40px rgba(0, 212, 255, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.15);
            border: 2px solid var(--primary-color);
            position: relative;
            animation: modalSlideIn 0.3s ease-out;
        }

        #post-modal .close {
            position: absolute;
            top: 15px;
            right: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid var(--danger-color);
            color: #ffffff;
            font-size: 1.8rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        #post-modal .close:hover {
            background: var(--danger-color);
            color: white;
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(255, 59, 48, 0.5);
        }

        #post-modal h2 {
            color: #ffffff;
            margin-bottom: 2rem;
            font-size: 1.8rem;
            text-shadow: 0 0 15px rgba(0, 212, 255, 0.6);
            display: flex;
            align-items: center;
            gap: 0.8rem;
            font-weight: 700;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 1rem;
        }

        #post-modal h2 i {
            color: var(--primary-color);
        }

        .post-form .form-group {
            margin-bottom: 1.5rem;
        }

        .post-form label {
            display: block;
            color: #ffffff;
            font-weight: 700;
            margin-bottom: 0.8rem;
            font-size: 1.1rem;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        .post-form .required {
            color: #ff6b6b;
            font-weight: bold;
        }

        .post-form input[type="text"],
        .post-form textarea,
        .post-form select {
            width: 100%;
            background: #2a2a2a;
            border: 2px solid #4a4a4a;
            color: #ffffff;
            padding: 1rem;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .post-form input[type="text"]::placeholder,
        .post-form textarea::placeholder {
            color: #a0a0a0;
            font-weight: normal;
        }

        .post-form input[type="text"]:focus,
        .post-form textarea:focus,
        .post-form select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.4);
            outline: none;
            background: #333333;
        }

        .post-form select option {
            background: #2a2a2a;
            color: #ffffff;
            padding: 0.5rem;
        }

        .post-form textarea {
            resize: vertical;
            min-height: 120px;
            line-height: 1.6;
        }

        .char-count {
            text-align: right;
            color: #c0c0c0;
            font-size: 0.9rem;
            margin-top: 0.3rem;
            font-weight: 600;
        }

        .form-hint {
            color: #b0b0b0;
            font-size: 0.9rem;
            margin-top: 0.3rem;
            font-style: italic;
            line-height: 1.4;
        }

        .tag-suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .tag-suggestion {
            background: var(--primary-color);
            color: #ffffff;
            padding: 0.4rem 1rem;
            border-radius: 15px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            border: 1px solid transparent;
        }

        .tag-suggestion:hover {
            background: var(--accent-color);
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3);
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 2px solid #4a4a4a;
        }

        .form-actions .btn {
            padding: 1rem 2rem;
            border-radius: 10px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-actions .btn-secondary {
            background: #555555;
            color: #ffffff;
            border: 2px solid #777777;
        }

        .form-actions .btn-secondary:hover {
            background: #666666;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            border-color: #888888;
        }

        .form-actions .btn-primary {
            background: linear-gradient(45deg, var(--primary-color), var(--accent-color));
            color: #ffffff;
            border: 2px solid var(--primary-color);
            font-weight: 700;
        }

        .form-actions .btn-primary:hover {
            background: linear-gradient(45deg, var(--accent-color), var(--success-color));
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 212, 255, 0.4);
            border-color: var(--success-color);
        }

        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes modalFadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        /* Responsive modal */
        @media (max-width: 768px) {
            #post-modal .modal-content {
                width: 95%;
                padding: 1.5rem;
                margin: 1rem;
            }
            
            .form-actions {
                flex-direction: column;
            }
            
            .form-actions .btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="container nav-container">
            <div class="logo">
                <a href="index.html" aria-label="MotoWeb homepage">
                    <img src="images/motoweb-logo.svg" alt="MotoWeb Logo" class="logo-img">
                </a>
            </div>
            <div class="nav-links" id="navLinks">
                <div class="main-nav">
                    <a href="index.html">Home</a>
                    <a href="products.html">Modification Parts</a>
                    <a href="community.html" class="active" aria-current="page">Community</a>
                    <a href="gallery.html">Gallery</a>
                    <a href="events.html">Events</a>
                </div>
                <div class="auth-buttons">
                    <a href="login.html" class="btn btn-secondary">Login</a>
                    <a href="register.html" class="btn btn-primary">Register</a>
                </div>
                <div class="user-menu" style="display: none;">
                    <div class="user-avatar">
                        <img src="/images/default-avatar.svg" alt="User Avatar" class="avatar">
                        <span class="username">Username</span>
                    </div>
                    <div class="dropdown-menu">
                        <a href="/profile.html"><i class="fas fa-user"></i> Profile</a>
                        <a href="/garage.html"><i class="fas fa-motorcycle"></i> My Garage</a>
                        <a href="/settings.html"><i class="fas fa-cog"></i> Settings</a>
                        <a href="#" id="logout"><i class="fas fa-sign-out-alt"></i> Logout</a>
                    </div>
                </div>
            </div>
            <button class="menu-toggle" aria-label="Toggle menu" aria-expanded="false" aria-controls="navLinks">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </button>
        </div>
    </nav>

    <main class="main-container">
        <header class="page-header">
            <h1>Community Forum</h1>
            <p>Share your modification experience and connect with fellow riders</p>
            <div class="search-bar">
                <input type="text" placeholder="Search discussions..." aria-label="Search discussions">
                <button type="button" class="search-btn">
                    <i class="fas fa-search"></i> Search
                </button>
            </div>
        </header>

        <main class="community-main-content">
            <aside class="community-sidebar">
                <h3>Categories</h3>
                <div class="category-list" id="category-list">
                    <ul>
                        <li><a href="#" class="active" data-category="all">All Discussions <span class="count">(0)</span></a></li>
                        <li><a href="#" data-category="performance">Performance Mods <span class="count">(0)</span></a></li>
                        <li><a href="#" data-category="suspension">Suspension & Handling <span class="count">(0)</span></a></li>
                        <li><a href="#" data-category="exhaust">Exhaust Systems <span class="count">(0)</span></a></li>
                        <li><a href="#" data-category="electronics">Electronics & Tech <span class="count">(0)</span></a></li>
                        <li><a href="#" data-category="appearance">Appearance Mods <span class="count">(0)</span></a></li>
                        <li><a href="#" data-category="maintenance">Maintenance & Care <span class="count">(0)</span></a></li>
                        <li><a href="#" data-category="track">Track Experience <span class="count">(0)</span></a></li>
                        <li><a href="#" data-category="review">Product Reviews <span class="count">(0)</span></a></li>
                    </ul>
                </div>

                <div class="popular-tags">
                    <h3>Popular Tags</h3>
                    <div class="tag-cloud">
                        <a href="#" class="tag" data-tag="performance">#Performance</a>
                        <a href="#" class="tag" data-tag="suspension">#Suspension</a>
                        <a href="#" class="tag" data-tag="exhaust">#Exhaust</a>
                        <a href="#" class="tag" data-tag="electronics">#Electronics</a>
                        <a href="#" class="tag" data-tag="customization">#Customization</a>
                        <a href="#" class="tag" data-tag="trackday">#TrackDay</a>
                        <a href="#" class="tag" data-tag="maintenance">#Maintenance</a>
                        <a href="#" class="tag" data-tag="products">#NewProducts</a>
                    </div>
                </div>
            </aside>

            <section class="community-display-area">
                <div class="community-header">
                    <div class="results-count">
                        <span>Showing all discussions</span>
                    </div>
                    <div class="view-options">
                        <button class="btn btn-primary" id="newDiscussionBtn">
                            <i class="fas fa-plus"></i> New Discussion
                        </button>
                    </div>
                </div>

                <div class="loading" id="loading">
                    <i class="fas fa-spinner fa-spin"></i> Loading...
                </div>

                <div class="discussion-list" id="discussions-grid">
                    <!-- Discussion items will be dynamically loaded here -->
                </div>

                <div class="pagination" id="pagination">
                    <!-- Pagination will be dynamically loaded here -->
                </div>
            </section>
        </main>
    </main>

    <!-- New Discussion Modal -->
    <div id="post-modal" class="modal">
        <div class="modal-content">
            <button class="close" aria-label="Close Modal">&times;</button>
            <h2><i class="fas fa-plus-circle"></i> Create New Discussion</h2>
            
            <form id="post-form" class="post-form">
                <div class="form-group">
                    <label for="post-title">Discussion Title <span class="required">*</span></label>
                    <input type="text" id="post-title" name="title" required maxlength="100" 
                           placeholder="Enter a compelling title for your discussion...">
                    <div class="char-count">
                        <span id="title-count">0</span>/100
                    </div>
                </div>

                <div class="form-group">
                    <label for="post-category">Category <span class="required">*</span></label>
                    <select id="post-category" name="category" required>
                        <option value="">Select a category</option>
                        <option value="performance">Performance Mods</option>
                        <option value="suspension">Suspension & Handling</option>
                        <option value="exhaust">Exhaust Systems</option>
                        <option value="electronics">Electronics & Tech</option>
                        <option value="appearance">Appearance Mods</option>
                        <option value="maintenance">Maintenance & Care</option>
                        <option value="track">Track Experience</option>
                        <option value="review">Product Reviews</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="post-content">Content <span class="required">*</span></label>
                    <textarea id="post-content" name="content" required rows="8" maxlength="5000"
                              placeholder="Share your thoughts, experiences, or questions with the community..."></textarea>
                    <div class="char-count">
                        <span id="content-count">0</span>/5000
                    </div>
                </div>

                <div class="form-group">
                    <label for="post-tags">Tags</label>
                    <input type="text" id="post-tags" name="tags" 
                           placeholder="Add tags separated by commas (e.g., honda, cbr600, exhaust)">
                    <div class="form-hint">
                        Add relevant tags to help others find your discussion
                    </div>
                    <div id="tag-suggestions" class="tag-suggestions"></div>
                </div>

                <div class="form-actions">
                    <button type="button" id="cancel-btn" class="btn btn-secondary">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                    <button type="submit" id="submit-btn" class="btn btn-primary">
                        <i class="fas fa-paper-plane"></i> Post Discussion
                    </button>
                </div>
            </form>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section about">
                    <div class="footer-logo">
                        <img src="images/motoweb-logo.svg" alt="MotoWeb Logo" class="footer-logo-img">
                    </div>
                    <p>Professional motorcycle modification community platform, providing a space for riders to communicate and share.</p>
                    <div class="social-links">
                        <a href="#" aria-label="Facebook"><i class="fab fa-facebook"></i></a>
                        <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                        <a href="#" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
                        <a href="#" aria-label="Discord"><i class="fab fa-discord"></i></a>
                    </div>
                </div>
                <div class="footer-section links">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="about.html">About Us</a></li>
                        <li><a href="products.html">Modification Parts</a></li>
                        <li><a href="community.html">Community Forum</a></li>
                        <li><a href="gallery.html">Gallery</a></li>
                        <li><a href="events.html">Events</a></li>
                    </ul>
                </div>
                <div class="footer-section contact">
                    <h3>Contact Info</h3>
                    <ul class="contact-info">
                        <li><i class="fas fa-envelope"></i> contact@MotoWeb.com</li>
                        <li><i class="fas fa-phone"></i> (02) 1234-5678</li>
                        <li><i class="fas fa-map-marker-alt"></i> No. 100, Songren Rd., Xinyi Dist., Taipei City</li>
                    </ul>
                </div>
                <div class="footer-section newsletter">
                    <h3>Newsletter</h3>
                    <p>Get the latest modification trends and event information</p>
                    <form class="newsletter-form" action="subscribe.php" method="POST">
                        <input type="email" name="email" placeholder="Your email" required>
                        <button type="submit" class="btn btn-primary">Subscribe</button>
                    </form>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 MotoWeb. All rights reserved.</p>
                <div class="footer-bottom-links">
                    <a href="privacy.html">Privacy Policy</a>
                    <a href="terms.html">Terms of Use</a>
                    <a href="cookies.html">Cookie Policy</a>
                </div>
            </div>
        </div>
    </footer>

    <button id="backToTop" class="back-to-top" aria-label="Back to top">
        <i class="fas fa-chevron-up"></i>
    </button>

    <script src="/js/common.js"></script>
    <script src="/js/auth-state.js"></script>
    <script src="/js/community-api.js"></script>
    <script>
        // Community API instance
        const communityAPI = new CommunityAPI();
        
        // Variable declarations
        let currentPage = 1;
        let currentCategory = 'all';
        let currentSearch = '';
        let isLoading = false;

        // DOM elements
        const discussionsGrid = document.getElementById('discussions-grid');
        const loadingIndicator = document.getElementById('loading');
        const paginationContainer = document.getElementById('pagination');
        const categoryLinks = document.querySelectorAll('.category-list a');
        const searchInput = document.querySelector('.search-bar input');
        const searchBtn = document.querySelector('.search-btn');
        let newPostBtn, modal, closeBtn, cancelBtn, submitBtn; // Declare these to be set after DOM load

        // ÂàÜÈ°ûÊò†Â∞Ñ - Â∞áËã±ÊñáÂàÜÈ°ûËΩâÊèõÁÇ∫Ëã±ÊñáÈ°ØÁ§∫
        const categoryMap = {
            'all': 'All Discussions',
            'performance': 'Performance Mods',
            'suspension': 'Suspension & Handling',
            'exhaust': 'Exhaust Systems',
            'electronics': 'Electronics & Tech',
            'appearance': 'Appearance Mods',
            'maintenance': 'Maintenance & Care',
            'track': 'Track Experience',
            'review': 'Product Reviews'
        };

        // Event listener for DOM content loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Community page DOM loaded');
            
            // Set modal elements after DOM is loaded
            newPostBtn = document.getElementById('newDiscussionBtn');
            modal = document.getElementById('post-modal');
            closeBtn = modal ? modal.querySelector('.close') : null;
            cancelBtn = document.getElementById('cancel-btn');
            submitBtn = document.getElementById('submit-btn');
            
            // Ensure modal is hidden initially
            const modalElement = document.getElementById('post-modal');
            if (modalElement) {
                modalElement.style.removeProperty('display');
                modalElement.classList.remove('show');
                console.log('Modal hidden initially');
                console.log('Modal initial class:', modalElement.className);
                console.log('Modal initial style:', window.getComputedStyle(modalElement).display);
                console.log('Modal initial z-index:', window.getComputedStyle(modalElement).zIndex);
            }
            
            // Check for existing elements
            console.log('New post button:', newPostBtn);
            console.log('Modal:', modal);
            console.log('Close button:', closeBtn);
            
            initializeFromURL();
            loadPosts();
            updateCategoryCounts();
            bindEvents();
            
            console.log('Community page fully loaded');
        });

        // Initialize from URL
        function initializeFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            currentPage = parseInt(urlParams.get('page')) || 1;
            currentCategory = urlParams.get('category') || 'all';
            currentSearch = urlParams.get('search') || '';
            
            // Reset active category links
            categoryLinks.forEach(link => {
                link.classList.remove('active');
                if (link.dataset.category === currentCategory) {
                    link.classList.add('active');
                }
            });
            
            // Reset search input
            if (currentSearch) {
                searchInput.value = currentSearch;
            }
        }

        // Load posts
        async function loadPosts() {
            if (isLoading) return;
            
            isLoading = true;
            showLoading();
            
            try {
                const options = {
                    page: currentPage,
                    limit: 6
                };
                
                if (currentCategory !== 'all') {
                    options.category = currentCategory;
                }
                
                if (currentSearch) {
                    options.search = currentSearch;
                }
                
                const response = await communityAPI.getPosts(options);
                displayPosts(response.posts);
                updatePagination(response);
                
            } catch (error) {
                console.error('Error loading posts:', error);
                showError('Error loading posts, please try again later');
            } finally {
                isLoading = false;
                hideLoading();
            }
        }

        // Display posts
        function displayPosts(posts) {
            if (!posts || posts.length === 0) {
                discussionsGrid.innerHTML = '<div class="no-posts">No posts found</div>';
                return;
            }
            
            const postsHTML = posts.map(post => `
                <article class="discussion-item">
                    <div class="discussion-avatar">
                        <img src="${post.avatar || 'images/default-avatar.svg'}" 
                             alt="${post.author} Avatar" 
                             onerror="this.src='images/default-avatar.svg'">
                    </div>
                    <div class="discussion-content">
                        <h3 class="discussion-title">
                            <a href="discussion-detail.html?id=${post._id}">${post.title}</a>
                        </h3>
                        
                        <div class="discussion-meta">
                            <span class="discussion-author">by ${post.author}</span>
                            <span class="discussion-date">${formatDate(post.createdAt)}</span>
                            <span class="discussion-category">${categoryMap[post.category] || post.category}</span>
                        </div>
                        
                        <p class="discussion-excerpt">${post.excerpt}</p>
                        
                        <div class="discussion-tags">
                            ${post.tags.map(tag => `<span class="discussion-tag" data-tag="${tag}">#${tag}</span>`).join('')}
                        </div>
                        
                        <div class="discussion-stats">
                            <span class="stats-item"><i class="fas fa-thumbs-up"></i> ${post.likes}</span>
                            <span class="stats-item"><i class="fas fa-eye"></i> ${post.views}</span>
                            <span class="stats-item"><i class="fas fa-comments"></i> ${post.commentCount}</span>
                        </div>
                    </div>
                </article>
            `).join('');
            
            discussionsGrid.innerHTML = postsHTML;
            
            // Bind tag click events
            bindTagEvents();
        }

        // Update pagination
        function updatePagination(response) {
            if (response.totalPages <= 1) {
                paginationContainer.innerHTML = '';
                return;
            }
            
            let paginationHTML = '';
            
            // Previous button
            if (currentPage > 1) {
                paginationHTML += `<a href="#" data-page="${currentPage - 1}">&laquo; Previous</a>`;
            }
            
            // Page numbers
            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(response.totalPages, currentPage + 2);
            
            if (startPage > 1) {
                paginationHTML += `<a href="#" data-page="1">1</a>`;
                if (startPage > 2) {
                    paginationHTML += '<span>...</span>';
                }
            }
            
            for (let i = startPage; i <= endPage; i++) {
                paginationHTML += `<a href="#" data-page="${i}" ${i === currentPage ? 'class="active"' : ''}>${i}</a>`;
            }
            
            if (endPage < response.totalPages) {
                if (endPage < response.totalPages - 1) {
                    paginationHTML += '<span>...</span>';
                }
                paginationHTML += `<a href="#" data-page="${response.totalPages}">${response.totalPages}</a>`;
            }
            
            // Next button
            if (currentPage < response.totalPages) {
                paginationHTML += `<a href="#" data-page="${currentPage + 1}">Next &raquo;</a>`;
            }
            
            paginationContainer.innerHTML = paginationHTML;
            
            // Bind pagination click events
            bindPaginationEvents();
        }

        // Update category counts
        async function updateCategoryCounts() {
            try {
                // Add loading animation to counts
                categoryLinks.forEach(link => {
                    const countSpan = link.querySelector('.count');
                    if (countSpan) {
                        countSpan.innerHTML = '<i class="fas fa-spinner fa-spin" style="font-size: 0.7rem;"></i>';
                    }
                });
                
                const response = await communityAPI.getPosts({ limit: 1000 }); // Áç≤ÂèñÊâÄÊúâË≤ºÊñá‰æÜÁµ±Ë®à
                const posts = response.posts || [];
                const total = response.total || posts.length;
                
                // Áµ±Ë®àÂêÑÂàÜÈ°ûÊï∏Èáè
                const categoryCounts = { all: total };
                
                posts.forEach(post => {
                    const category = post.category;
                    if (category) {
                        if (!categoryCounts[category]) {
                            categoryCounts[category] = 0;
                        }
                        categoryCounts[category]++;
                    }
                });
                
                // Êõ¥Êñ∞ÂàÜÈ°ûÈÄ£ÁµêÁöÑÊï∏ÈáèÈ°ØÁ§∫ÔºåÊ∑ªÂä†ÂãïÁï´ÊïàÊûú
                categoryLinks.forEach(link => {
                    const category = link.dataset.category;
                    const countSpan = link.querySelector('.count');
                    
                    if (countSpan) {
                        const count = categoryCounts[category] || 0;
                        
                        // Ê∑°ÂÖ•ÂãïÁï´
                        countSpan.style.opacity = '0';
                        setTimeout(() => {
                            countSpan.textContent = `(${count})`;
                            countSpan.style.opacity = '1';
                            
                            // Â¶ÇÊûúÊï∏ÈáèÂ§ßÊñº 0ÔºåÊ∑ªÂä†ËÑàË°ùÊïàÊûú
                            if (count > 0) {
                                countSpan.style.animation = 'countPulse 0.5s ease-out';
                                setTimeout(() => {
                                    countSpan.style.animation = '';
                                }, 500);
                            }
                        }, 200);
                    }
                });
                
                console.log('ÂàÜÈ°ûÁµ±Ë®àÊõ¥Êñ∞ÂÆåÊàê:', categoryCounts);
            } catch (error) {
                console.error('Êõ¥Êñ∞ÂàÜÈ°ûÁµ±Ë®àÂ§±Êïó:', error);
                
                // Â¶ÇÊûúAPIÂ§±ÊïóÔºåÈ°ØÁ§∫È†êË®≠Êï∏Èáè
                categoryLinks.forEach(link => {
                    const countSpan = link.querySelector('.count');
                    if (countSpan) {
                        countSpan.textContent = '(0)';
                        countSpan.style.opacity = '1';
                    }
                });
            }
        }

        // Bind events
        function bindEvents() {
            console.log('Binding events');
            
            // Category links with enhanced functionality
            categoryLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    
                    // Remove active class from all links with animation
                    categoryLinks.forEach(l => {
                        l.classList.remove('active');
                        // Reset any visual indicators
                        const count = l.querySelector('.count');
                        if (count) {
                            count.style.transform = 'scale(1)';
                        }
                    });
                    
                    // Add active class with animation
                    link.classList.add('active');
                    const activeCount = link.querySelector('.count');
                    if (activeCount) {
                        activeCount.style.transform = 'scale(1.1)';
                        setTimeout(() => {
                            activeCount.style.transform = 'scale(1)';
                        }, 200);
                    }
                    
                    // Update current category and reset pagination
                    currentCategory = link.dataset.category;
                    currentPage = 1;
                    currentSearch = '';
                    
                    // Clear search input
                    if (searchInput) {
                        searchInput.value = '';
                    }
                    
                    // Update results count display with animation
                    const resultsCount = document.querySelector('.results-count span');
                    if (resultsCount) {
                        const categoryText = categoryMap[currentCategory] || currentCategory;
                        resultsCount.style.opacity = '0.5';
                        setTimeout(() => {
                            resultsCount.textContent = `Showing ${categoryText}`;
                            resultsCount.style.opacity = '1';
                        }, 150);
                    }
                    
                    // Add visual feedback
                    link.style.transform = 'translateX(10px)';
                    setTimeout(() => {
                        link.style.transform = 'translateX(5px)';
                    }, 200);
                    
                    updateURL();
                    loadPosts();
                    
                    console.log('ÂàÜÈ°ûÂàáÊèõËá≥:', currentCategory);
                });
                
                // Add hover effects
                link.addEventListener('mouseenter', () => {
                    if (!link.classList.contains('active')) {
                        link.style.transform = 'translateX(3px)';
                    }
                });
                
                link.addEventListener('mouseleave', () => {
                    if (!link.classList.contains('active')) {
                        link.style.transform = 'translateX(0)';
                    }
                });
            });
            
            // Enhanced search functionality
            if (searchBtn) {
                searchBtn.addEventListener('click', performSearch);
            }
            if (searchInput) {
                let searchTimeout;
                
                // Real-time search with debouncing
                searchInput.addEventListener('input', () => {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(() => {
                        if (searchInput.value.trim().length > 2 || searchInput.value.trim().length === 0) {
                            performSearch();
                        }
                    }, 500);
                });
                
                searchInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        clearTimeout(searchTimeout);
                        performSearch();
                    }
                });
                
                // Visual feedback for search input
                searchInput.addEventListener('focus', () => {
                    searchInput.parentElement.style.boxShadow = '0 0 25px rgba(0, 212, 255, 0.4)';
                });
                
                searchInput.addEventListener('blur', () => {
                    searchInput.parentElement.style.boxShadow = '';
                });
            }
            
            // Enhanced tag functionality
            const tagElements = document.querySelectorAll('.tag[data-tag]');
            tagElements.forEach(tag => {
                tag.addEventListener('click', (e) => {
                    e.preventDefault();
                    const tagValue = tag.dataset.tag;
                    
                    // If search input exists, use it
                    if (searchInput) {
                        searchInput.value = tagValue;
                        performSearch();
                    } else {
                        // Directly use tag if no search input
                        currentSearch = tagValue;
                        currentPage = 1;
                        currentCategory = 'all';
                        updateURL();
                        loadPosts();
                    }
                });
            });
            
            // Modal event listeners with enhanced animations
            console.log('Preparing modal event listeners');
            console.log('newPostBtn:', newPostBtn);
            console.log('closeBtn:', closeBtn);
            console.log('cancelBtn:', cancelBtn);
            console.log('submitBtn:', submitBtn);
            
            if (newPostBtn) {
                console.log('Binding new discussion button');
                newPostBtn.addEventListener('click', function(e) {
                    console.log('New discussion button clicked');
                    e.preventDefault();
                    
                    // Button animation
                    this.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        this.style.transform = 'scale(1)';
                    }, 100);
                    
                    openModal();
                });
            } else {
                console.error('New discussion button not found');
            }
            
            if (closeBtn) {
                closeBtn.addEventListener('click', closeModal);
            }
            if (cancelBtn) {
                cancelBtn.addEventListener('click', closeModal);
            }
            if (submitBtn) {
                submitBtn.addEventListener('click', handleSubmitPost);
            }
            
            // Click outside modal
            window.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeModal();
                }
            });
            
            // Escape key to close modal
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && modal && modal.classList.contains('show')) {
                    closeModal();
                }
            });
            
            console.log('Event listeners bound');
        }

        // Enhanced search function
        function performSearch() {
            const searchTerm = searchInput.value.trim();
            
            // Visual feedback for search
            const searchButton = document.querySelector('.search-btn');
            if (searchButton) {
                const originalText = searchButton.innerHTML;
                searchButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Searching...';
                searchButton.disabled = true;
                
                setTimeout(() => {
                    searchButton.innerHTML = originalText;
                    searchButton.disabled = false;
                }, 1000);
            }
            
            currentSearch = searchTerm;
            currentPage = 1;
            currentCategory = 'all';
            
            // Reset active links
            categoryLinks.forEach(link => {
                link.classList.remove('active');
                if (link.dataset.category === 'all') {
                    link.classList.add('active');
                }
            });
            
            // Update results display
            const resultsCount = document.querySelector('.results-count span');
            if (resultsCount) {
                if (searchTerm) {
                    resultsCount.textContent = `Searching for "${searchTerm}"`;
                } else {
                    resultsCount.textContent = 'Showing All Discussions';
                }
            }
            
            updateURL();
            loadPosts();
        }

        // Enhanced modal functions
        function openModal() {
            console.log('openModal function called');
            
            // Check login status - using same method as gallery and events
            const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
            
            if (!isLoggedIn) {
                console.log('User not logged in, showing login prompt modal');
                showLoginPromptModal();
                return;
            }
            
            console.log('User logged in, opening discussion modal');
            
            const modalElement = document.getElementById('post-modal');
            if (modalElement) {
                console.log('Modal displayed');
                // Remove all styles and rely on CSS classes
                modalElement.style.removeProperty('display');
                modalElement.classList.add('show');
                
                // Add entrance animation
                modalElement.style.animation = 'modalFadeIn 0.3s ease-out';
                
                console.log('Modal classes:', modalElement.className);
                console.log('Modal computed style:', window.getComputedStyle(modalElement).display);
                initTagInput();
            } else {
                console.error('Modal element not found');
            }
        }

        /**
         * Show login prompt modal
         */
        function showLoginPromptModal() {
            // Create login prompt modal
            let loginPromptModal = document.getElementById('loginPromptModal');
            
            if (!loginPromptModal) {
                loginPromptModal = document.createElement('div');
                loginPromptModal.id = 'loginPromptModal';
                loginPromptModal.className = 'modal';
                loginPromptModal.innerHTML = `
                    <div class="modal-content" style="max-width: 500px; text-align: center; padding: 3rem 2rem; background: linear-gradient(145deg, #1a1a1a, #2d2d2d); border: 2px solid var(--primary-color);">
                        <button class="modal-close" id="closeLoginPrompt">&times;</button>
                        <div class="login-prompt-content">
                            <div class="login-icon" style="margin-bottom: 2rem;">
                                <i class="fas fa-user-lock" style="font-size: 4rem; color: var(--primary-color); text-shadow: 0 0 20px rgba(0, 212, 255, 0.5);"></i>
                            </div>
                            <h2 style="color: #ffffff; margin-bottom: 1.5rem; text-shadow: 0 0 15px rgba(0, 212, 255, 0.6); font-weight: 700; font-size: 1.8rem;">Login Required to Post</h2>
                            <p style="color: #e0e0e0; margin-bottom: 2rem; line-height: 1.8; font-size: 1.1rem; font-weight: 500;">
                                You need to log in to your account to create new discussions and participate in the community.<br>
                                Log in to enjoy the full community features.
                            </p>
                            <div class="login-actions" style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                                <a href="login.html" class="btn btn-primary" style="display: inline-flex; align-items: center; gap: 0.5rem; text-decoration: none; background: linear-gradient(45deg, var(--primary-color), var(--accent-color)); color: #ffffff; border: 2px solid var(--primary-color); font-weight: 700; padding: 1rem 1.5rem; font-size: 1rem;">
                                    <i class="fas fa-sign-in-alt"></i> Login Now
                                </a>
                                <a href="register.html" class="btn btn-outline" style="display: inline-flex; align-items: center; gap: 0.5rem; text-decoration: none; background: rgba(0, 212, 255, 0.1); color: #ffffff; border: 2px solid var(--primary-color); font-weight: 700; padding: 1rem 1.5rem; font-size: 1rem;">
                                    <i class="fas fa-user-plus"></i> Register Account
                                </a>
                            </div>
                        </div>
                    </div>
                `;
                document.body.appendChild(loginPromptModal);
                
                // Bind close events
                const closeLoginPrompt = loginPromptModal.querySelector('#closeLoginPrompt');
                closeLoginPrompt.addEventListener('click', function() {
                    loginPromptModal.classList.remove('active');
                    document.body.style.overflow = '';
                });
                
                // Click outside modal to close
                loginPromptModal.addEventListener('click', function(e) {
                    if (e.target === loginPromptModal) {
                        loginPromptModal.classList.remove('active');
                        document.body.style.overflow = '';
                    }
                });
            }
            
            // Show modal
            loginPromptModal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // Enhanced close modal function
        function closeModal() {
            const modalElement = document.getElementById('post-modal');
            if (modalElement) {
                // Add exit animation
                modalElement.style.animation = 'modalFadeOut 0.3s ease-out';
                
                setTimeout(() => {
                    modalElement.classList.remove('show');
                    modalElement.style.animation = '';
                    console.log('Modal closed');
                    clearForm();
                }, 300);
            }
        }

        // Clear form
        function clearForm() {
            document.getElementById('post-title').value = '';
            document.getElementById('post-category').value = '';
            document.getElementById('post-content').value = '';
            document.getElementById('tag-input').value = '';
            
            // Clear tags
            const tagItems = document.querySelectorAll('.tag-item');
            tagItems.forEach(item => item.remove());
        }

        // Handle post submission
        async function handleSubmitPost() {
            const title = document.getElementById('post-title').value.trim();
            const category = document.getElementById('post-category').value;
            const content = document.getElementById('post-content').value.trim();
            
            if (!title || !category || !content) {
                alert('Please fill out all fields');
                return;
            }
            
            // Extract tags
            const tagItems = document.querySelectorAll('.tag-item');
            const tags = Array.from(tagItems).map(item => item.dataset.tagValue);
            
            try {
                submitBtn.disabled = true;
                submitBtn.textContent = 'Submitting...';
                
                await communityAPI.createPost({
                    title,
                    category,
                    content,
                    tags
                });
                
                alert('Discussion posted successfully');
                closeModal();
                
                // Refresh discussion list
                currentPage = 1;
                loadPosts();
                updateCategoryCounts();
                
            } catch (error) {
                console.error('Error submitting discussion:', error);
                alert('Error submitting discussion: ' + error.message);
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit';
            }
        }
        
        // Tag input functionality
        function initTagInput() {
            const tagInput = document.getElementById('tag-input');
            const tagContainer = document.getElementById('tag-container');
            
            tagInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    
                    const tagValue = tagInput.value.trim();
                    if (!tagValue) return;
                    
                    // Check for existing tags
                    const existingTags = Array.from(tagContainer.querySelectorAll('.tag-item'))
                        .map(tag => tag.dataset.tagValue);
                    
                    if (existingTags.includes(tagValue)) {
                        tagInput.value = '';
                        return;
                    }
                    
                    // Limit tag count
                    if (existingTags.length >= 5) {
                        alert('Only 5 tags allowed');
                        return;
                    }
                    
                    // Create tag item
                    const tagItem = document.createElement('div');
                    tagItem.className = 'tag-item';
                    tagItem.dataset.tagValue = tagValue;
                    tagItem.innerHTML = `
                        ${tagValue}
                        <span class="tag-remove">&times;</span>
                    `;
                    
                    // Remove tag
                    const removeBtn = tagItem.querySelector('.tag-remove');
                    removeBtn.addEventListener('click', () => {
                        tagItem.remove();
                    });
                    
                    // Insert tag
                    tagContainer.insertBefore(tagItem, tagInput);
                    tagInput.value = '';
                }
            });
        }
        
        // Update URL
        function updateURL() {
            const params = new URLSearchParams();
            
            if (currentPage > 1) {
                params.append('page', currentPage);
            }
            
            if (currentCategory !== 'all') {
                params.append('category', currentCategory);
            }
            
            if (currentSearch) {
                params.append('search', currentSearch);
            }
            
            const newURL = `${window.location.pathname}${params.toString() ? '?' + params.toString() : ''}`;
            window.history.pushState(null, '', newURL);
        }

        // Show loading indicator
        function showLoading() {
            loadingIndicator.style.display = 'block';
            discussionsGrid.style.opacity = '0.5';
        }

        // Hide loading indicator
        function hideLoading() {
            loadingIndicator.style.display = 'none';
            discussionsGrid.style.opacity = '1';
        }

        // Show error message
        function showError(message) {
            discussionsGrid.innerHTML = `<div class="error-message">${message}</div>`;
        }

        // Format date
        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffTime = Math.abs(now - date);
            const diffMinutes = Math.floor(diffTime / (1000 * 60));
            const diffHours = Math.floor(diffTime / (1000 * 60 * 60));
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffMinutes < 1) {
                return 'just now';
            } else if (diffMinutes < 60) {
                return `${diffMinutes} minute${diffMinutes > 1 ? 's' : ''} ago`;
            } else if (diffHours < 24) {
                return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;
            } else if (diffDays === 1) {
                return '1 day ago';
            } else if (diffDays < 7) {
                return `${diffDays} days ago`;
            } else if (diffDays < 30) {
                const weeks = Math.floor(diffDays / 7);
                return `${weeks} weeks ago`;
            } else {
                return date.toLocaleDateString('en-US');
            }
        }

        // Test button - direct test function
        function testButton() {
            console.log('=== Test button ===');
            
            setTimeout(() => {
                const btn = document.getElementById('newDiscussionBtn');
                console.log('Button:', btn);
                console.log('Button class:', btn ? btn.className : 'Not found');
                console.log('Button text:', btn ? btn.textContent : 'Not found');
                console.log('Button parent:', btn ? btn.parentElement : 'Not found');
                
                if (btn) {
                    console.log('Testing button click...');
                    btn.click();
                }
                
                // Check modal
                console.log('Modal:', document.getElementById('post-modal'));
                console.log('Modal style:', document.getElementById('post-modal') ? window.getComputedStyle(document.getElementById('post-modal')).display : 'Not found');
                
                console.log('=== Test result ===');
            }, 2000);
        }
        
        // Test button - setTimeout test
        setTimeout(testButton, 3000);
        
        // Use case: directly on DOM load after completion
        document.addEventListener('DOMContentLoaded', function() {
            // Wait a short while to ensure DOM is fully ready
            setTimeout(() => {
                const backupBtn = document.getElementById('newDiscussionBtn');
                console.log('Use case:', backupBtn);
                
                if (backupBtn) {
                    // Remove existing event listeners
                    const newBtn = backupBtn.cloneNode(true);
                    backupBtn.parentNode.replaceChild(newBtn, backupBtn);
                    
                    // Bind new button click event
                    newBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log('Use case: button clicked');
                        
                        // Check login status - using same method as other pages
                        const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
                        
                        if (!isLoggedIn) {
                            console.log('Backup handler: User not logged in, showing login prompt');
                            showLoginPromptModal();
                            return;
                        }
                        
                        console.log('Backup handler: User logged in, opening discussion modal');
                        
                        // Directly show modal
                        const modal = document.getElementById('post-modal');
                        if (modal) {
                            modal.style.removeProperty('display');
                            modal.classList.add('show');
                            console.log('Use case: modal displayed');
                            console.log('Use case: modal classes:', modal.className);
                            console.log('Use case: modal computed style:', window.getComputedStyle(modal).display);
                        } else {
                            console.error('Use case: modal not found');
                        }
                    });
                    
                    console.log('Use case: condition check done');
                } else {
                    console.error('Use case: button not found');
                }
            }, 500);
        });
        
        // Add CSS animations for enhanced user experience
        const animationStyles = document.createElement('style');
        animationStyles.textContent = `
            @keyframes modalFadeIn {
                from {
                    opacity: 0;
                    transform: translate(-50%, -60%);
                }
                to {
                    opacity: 1;
                    transform: translate(-50%, -50%);
                }
            }
            
            @keyframes modalFadeOut {
                from {
                    opacity: 1;
                    transform: translate(-50%, -50%);
                }
                to {
                    opacity: 0;
                    transform: translate(-50%, -60%);
                }
            }
            
            @keyframes countPulse {
                0%, 100% { transform: scale(1); }
                50% { transform: scale(1.2); }
            }
            
            .custom-alert {
                animation: modalFadeIn 0.3s ease-out !important;
            }
            
            /* Enhanced transition effects */
            .category-list a {
                transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1) !important;
            }
            
            .tag {
                transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1) !important;
            }
            
            .search-bar {
                transition: all 0.3s ease !important;
            }
        `;
        document.head.appendChild(animationStyles);
        
        // Test modal number - ensure all posts have correct header
        function loadTestPosts() {
            const testPosts = [
                {
                    _id: 'test1',
                    title: 'First Modification Experience',
                    author: 'User1',
                    avatar: '', // Empty avatar for testing
                    createdAt: new Date().toISOString(),
                    category: 'Performance Mods',
                    excerpt: 'Just got my first motorcycle and want to share my experience...',
                    tags: ['Performance', 'First Mod', 'Experience'],
                    likes: 15,
                    views: 234,
                    commentCount: 8
                },
                {
                    _id: 'test2',
                    title: 'How to Choose the Right Motorcycle',
                    author: 'User2',
                    avatar: null, // Null avatar for testing
                    createdAt: new Date(Date.now() - 24*60*60*1000).toISOString(),
                    category: 'Suspension & Handling',
                    excerpt: 'How important is the suspension system for a motorcycle? Should I prioritize it over other aspects?',
                    tags: ['Suspension', 'Motorcycle', 'Choosing'],
                    likes: 42,
                    views: 567,
                    commentCount: 23
                },
                {
                    _id: 'test3',
                    title: 'LED Headlight Upgrade',
                    author: 'User3',
                    // Completely not setting avatar attribute
                    createdAt: new Date(Date.now() - 2*24*60*60*1000).toISOString(),
                    category: 'Electronics & Tech',
                    excerpt: 'LED headlights are not powered by electricity, but they are brighter and more efficient than traditional bulbs.',
                    tags: ['LED', 'Headlight', 'Upgrade'],
                    likes: 28,
                    views: 189,
                    commentCount: 12
                }
            ];
            
            displayPosts(testPosts);
            const countElement = document.querySelector('.results-count span');
            if (countElement) {
                countElement.textContent = `Found ${testPosts.length} discussion posts`;
            }
        }
        
        // If loading is not done, load test posts
        setTimeout(() => {
            const gridContent = document.getElementById('discussions-grid').innerHTML;
            if (!gridContent || gridContent.includes('Loading...') || gridContent.includes('No posts found')) {
                console.log('Test posts loaded to ensure correct header display');
                loadTestPosts();
            }
        }, 5000);

        // Bind tag click events
        function bindTagEvents() {
            const tagElements = document.querySelectorAll('.discussion-tag[data-tag], .tag[data-tag]');
            tagElements.forEach(tag => {
                tag.addEventListener('click', (e) => {
                    e.preventDefault();
                    const tagValue = tag.dataset.tag;
                    
                    // If search input exists, use it
                    if (searchInput) {
                        searchInput.value = tagValue;
                        performSearch();
                    } else {
                        // Directly use tag if no search input
                        currentSearch = tagValue;
                        currentPage = 1;
                        currentCategory = 'all';
                        updateURL();
                        loadPosts();
                    }
                });
            });
        }

        // Bind pagination click events
        function bindPaginationEvents() {
            const pageLinks = paginationContainer.querySelectorAll('a[data-page]');
            pageLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    currentPage = parseInt(link.dataset.page);
                    updateURL();
                    loadPosts();
                    window.scrollTo(0, 0);
                });
            });
        }
    </script>
</body>
</html>
