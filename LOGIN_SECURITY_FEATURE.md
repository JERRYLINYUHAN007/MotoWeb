<!-- Code Function: FINAL PROJECT MotoWeb      Date: 02/06/2025, created by: JERRY -->
# 登錄安全功能說明

## 功能概述

這個功能實現了登錄嘗試限制，以防止暴力破解攻擊。

## 工作機制

### 後端邏輯 (server.js)

1. **記錄登錄嘗試**：
   - 為每個 IP 地址記錄登錄失敗次數
   - 使用 MongoDB 的 `login_attempts` 集合存儲數據
   - 包含字段：`key`、`attempts`、`firstAttempt`、`lastAttempt`、`lockedUntil`

2. **鎖定機制**：
   - 第 5 次錯誤後：鎖定 1 分鐘
   - 第 6 次及之後錯誤：鎖定 5 分鐘
   - 24 小時後自動重置計數器

3. **API 端點**：
   - `POST /api/login` - 增強了登錄驗證和錯誤計數
   - `GET /api/login-status` - 檢查當前登錄狀態

### 前端邏輯 (public/js/login.js)

1. **倒計時顯示**：
   - 被鎖定時顯示覆蓋層和倒計時器
   - 實時更新剩餘時間
   - 鎖定期間禁用表單

2. **狀態檢查**：
   - 頁面加載時檢查是否已被鎖定
   - 顯示警告消息告知剩餘嘗試次數

## 功能特色

- ✅ **IP 級別限制**：基於 IP 地址而非用戶帳戶
- ✅ **視覺化倒計時**：漂亮的倒計時器和動畫效果
- ✅ **自動恢復**：時間到期後自動解鎖
- ✅ **漸進式懲罰**：第一次鎖定較短，之後增加
- ✅ **狀態持久化**：服務器重啟後狀態保持
- ✅ **用戶友好**：清楚的中文提示和警告

## 測試方法

1. **測試鎖定機制**：
   ```
   1. 打開登錄頁面
   2. 故意輸入錯誤密碼 5 次
   3. 觀察是否出現 1 分鐘的倒計時鎖定
   4. 等待解鎖後再次輸入錯誤密碼
   5. 觀察是否出現 5 分鐘的鎖定
   ```

2. **測試狀態檢查**：
   ```
   1. 在被鎖定期間重新整理頁面
   2. 檢查是否仍顯示倒計時
   3. 檢查倒計時是否準確
   ```

## 數據庫結構

```javascript
// login_attempts 集合
{
  key: "login_attempts_192.168.1.100",
  attempts: 5,
  firstAttempt: ISODate("2024-01-01T10:00:00Z"),
  lastAttempt: ISODate("2024-01-01T10:05:00Z"),
  lockedUntil: ISODate("2024-01-01T10:06:00Z")
}
```

## 安全考量

- 使用 IP 地址而非用戶帳戶可以防止攻擊者針對特定用戶
- 24 小時自動重置可以避免永久鎖定合法用戶
- 客戶端和服務器端雙重驗證確保安全性

## 未來改進

- 可以考慮加入 CAPTCHA 驗證
- 可以實現基於用戶帳戶的額外限制
- 可以加入管理員解鎖功能
- 可以實現 IP 白名單機制 